Throughout this section $A$ denotes an arbitrary commutative ring.

\subsection{Curtis--Tits type presentation of affine Steinberg groups} \label{subsec:curtis-tits}
In this subsection we briefly recall generalization of Steinberg groups to the Kac--Moody setting.
Only in this subsection we allow root systems to be infinite.

Recall that to any generalized Cartan matrix one can associate (possibly infinite) root system $\Phi$ and the Steinberg group functor $\St(\Phi, -)$.
Two definitions of this functor have been proposed: the definition of J.~Tits~\cite[\S~3.6]{Ti87} and the definition of J.~Morita and U.~Rehmann~\cite[\S~2]{MR90}.
These definitions agree if the Dynkin diagram of the GCM does not contain connected components of type $\rA_1$, see~\cite[\S~6]{A13}.

For our purposes it will be sufficient to restrict attention to the case of a GCM of \textit{affine} type, or, in other words, GCM whose Dynkin diagram is the \textit{extended} Dynkin diagram of a finite irreducible simply-laced root system $\Phi$ of rank $>1$.
Such digrams for $\Phi$ of type $\rD_\ell$, $\rE_6$ and $\rE_7$ are depicted on Figure 1 (the added root is marked with yellow color and index $0$).

\tikzset{
    root/.style={circle, draw, minimum size=0.2cm, inner sep=0},
    zeroroot/.style={circle, draw, minimum size=0.2cm, inner sep=0, fill=yellow},
    highlighted/.style={circle, draw, minimum size=0.2cm, inner sep=0, fill=green},
    levi/.style={draw, dashed, rounded corners},
    dottededge/.style={dotted},
    labeled/.style={below}
}
\begin{figure}[hb]\label{fig:dynkin-diagrams}
\begin{longtable}{ c c c }
    \scalebox{0.69}{\begin{tikzpicture}
                        \node[root, highlighted, label=$1$] (d1) at (0,0.5) {};
                        \node[root, label=$2$] (d2) at (1,0) {};
                        \node[root, label=$3$] (d3) at (2,0) {};
                        \node at (3,0) {\ldots};
                        \node[root, label={[xshift=-0.5cm, yshift=-0.6cm]$\ell-2$}] (dl2) at (4,0) {};
                        \node[root, label={[xshift=-0.6cm, yshift=-0.35cm]$\ell-1$}] (dl1) at (5,0.5) {};
                        \node[root, label={[xshift=-0.5cm, yshift=-0.3cm]$\ell$}] (dl) at (5,-0.5) {};
                        \node[root, zeroroot, label=below:{$0$}] (d0) at (0,-0.5) {};

                        \draw (d1) -- (d2) -- (d3) -- (2.5,0);
                        \draw (3.5,0) -- (dl2) -- (dl1);
                        \draw (dl2) -- (dl);
                        \draw[dottededge] (d2) -- (d0);

                        \begin{scope}
                            \node[levi, fit=(d2) (d3) (dl) (dl1) (dl2), label=above:{$\Delta$}] {};
                        \end{scope}
    \end{tikzpicture}}
    &
    \scalebox{0.69}{\begin{tikzpicture}
                        \begin{scope}
                            \node[root, highlighted, label=$1$] (e1) at (0,0) {};
                            \node[root, label=$3$] (e3) at (1,0) {};
                            \node[root, label={[xshift=-0.3cm]$4$}] (e4) at (2,0) {};
                            \node[root, label=$5$] (e5) at (3,0) {};
                            \node[root, label=$6$] (e6) at (4,0) {};
                            \node[root, label={[xshift=-0.3cm,yshift=-0.3cm]$2$}] (e2) at (2,1) {};
                            \node[root, zeroroot, label=left:$0$] (e0) at (2,2) {};
                            \draw (e1) -- (e3) -- (e4) -- (e5) -- (e6);
                            \draw (e2) -- (e4);
                            \draw[dottededge] (e2) -- (e0);

                            \begin{scope}
                                \node[levi, fit= (e2) (e3) (e4) (e5) (e6), label=above:{$\Delta$}] {};
                            \end{scope}
                        \end{scope}
    \end{tikzpicture}}
    &
    \scalebox{0.69}{\begin{tikzpicture}
                        \begin{scope}
                            \node[root, zeroroot, label={0}] (e0) at (0,0) {};
                            \node[root, label={$1$}] (e1) at (1,0) {};
                            \node[root, label={$3$}] (e3) at (2,0) {};
                            \node[root, label={[xshift=-0.3cm]$4$}] (e4) at (3,0) {};
                            \node[root, label={$5$}] (e5) at (4,0) {};
                            \node[root, label={$6$}] (e6) at (5,0) {};
                            \node[root, label={[xshift=-0.3cm,yshift=-0.3cm]$2$}] (e2) at (3,1) {};
                            \node[root, highlighted, label={$7$}] (e7) at (6,0) {};

                            \draw (e1) -- (e3) -- (e4) -- (e5) -- (e6) -- (e7);
                            \draw (e2) -- (e4);
                            \draw[dottededge] (e0) -- (e1);

                            \begin{scope}
                                \node[levi, fit=(e1) (e2) (e3) (e4) (e5) (e6), label=above:{$\Delta$}] {};
                            \end{scope}
                        \end{scope}
    \end{tikzpicture}} \\
    \text{$\rD_\ell$} &
    \text{$\rE_6$} &
    \text{$\rE_7$}
\end{longtable}
\caption{Root markings on extended Dynkin diagrams}
\end{figure}

Denote by $\widetilde{\Phi}$ the affine root system corresponding to $\Phi$.
Recall from~\cite[\S~4]{A16} that the set of real roots of $\widetilde{\Phi}$ is isomorphic to $\Phi \times \ZZ$.
\begin{lemma} \label{lem:affine-vs-loop} $\St(\widetilde{\Phi}, A) \cong \St(\Phi, A[X, X\inv])$.
\end{lemma}
\begin{proof}
    By definition, the group $\mathrm{St}(\widetilde{\Phi}, A)$ is presented by generators $x_{(\alpha, m)}(a)$, $a \in A$, $\alpha \in \Phi$ and
    the following relations:
    \begin{align}
        x_{(\alpha, m)}(a)\cdot x_{(\alpha, m)}(b)&=x_{(\alpha, m)}(a+b),  \label{AR1}\\
        [x_{(\alpha, m)}(a),\,x_{(\beta, n)}(b)]  &=x_{(\alpha+\beta, n+m)}(N_{\alpha,\beta} \cdot ab),\text{ for }\alpha+\beta\in\Phi, \label{AR2} \\
        [x_{(\alpha, m)}(a),\,x_{(\beta, n)}(b)]  &=1,\text{ for }\alpha+\beta\not\in\Phi\cup0. \label{AR3}
    \end{align}
    It is not hard to check that the homomorphism given by $x_{(\alpha, m)}(a) \mapsto x_\alpha(aX^m)$ is an isomorphism with the inverse given by
    $x_\alpha(a_{n}X^n + \ldots + a_m X^m) \mapsto \Pi\limits_{i=n}^m x_{(\alpha, i)}(a_i)$, $a_i \in A$, $n \leq m$, $n, m\in \ZZ$.
\end{proof}

Our next goal is to formulate the so-called \textit{Curtis--Tits presentation} of affine Steinberg groups discovered by D.~Allcock in~\cite{A16, A13}.
This presentation has the advantage of being formulated in terms of the Dynkin diagram of $\Phi$ rather than the (possibly infinite) set of real roots of $\Phi$.
Its other advantage is that it requires no choice of structure constants in its statement.
Allcock's result is the generalization of Curtis--Tits presentations of finite root system, which has been known since 1960's, see e.\,g.~\cite[Theorem~B]{DS74}.

Recall that $\{ \alpha_1, \ldots \alpha_\ell \}$ is the set of simple roots of $\Phi$.
We denote by $\alpha_0$ the opposite root to the maximal root of $\Phi$ (i.\,e. $\alpha_0 := -\alpha_\mathrm{max}$).
This root corresponds to the added $0$ node of the extended Dynkin diagram depicted on Figure 1.
We denote by $X_0(A)$ the root group $\{ X_0(a) \mid a \in A\}$ (as a group it is isomorphic to the additive group of $A$).
We also denote by $j$ the root adjacent to $0$ on the extended Dynkin diagram of $\Phi$.
\begin{prop} \label{prop:Allcock-affine} The group $\St(\Phi, A[X, X\inv])$ is isomorphic to the free product of $\St(\Phi, A)$, the group $X_0(A)$ and the free cyclic group $\langle S_0 \rangle$
     amalgamated over the subgroup generated by the following list of relations:
    {\allowdisplaybreaks\begin{align}
        [S_0^2, X_0(a)] & = 1 & \text{ for $a \in A$; } \label{eq:Allcock-2} \\
        X_0(1) \cdot {}^{S_0} X_0(1) \cdot X_0(1) & = S_0; \label{eq:Allcock-3} \\
        [S_0, w_{\alpha_i}(1)] & = 1; &  \label{eq:Allcock-4} \\
        [S_0, x_{\alpha_i}(a)] & = 1, &  \label{eq:Allcock-5-1}\\
        [w_{\alpha_i}(1), X_0(a)] & = 1 & \text{$i$ unjoined with $0$, $a \in A;$} \label{eq:Allcock-5-2} \\
        [X_0(a), x_{\alpha_i}(b)] & = 1 & \text{$i$ unjoined with $0$, $a, b \in A;$} \label{eq:Allcock-6} \\
        S_0 \cdot w_{\alpha_j}(1) \cdot S_0 & = w_{\alpha_j}(1) \cdot S_0 \cdot w_{\alpha_j}(1); \label{eq:Allcock-7} \\
        {}^{S_0^2} w_{\alpha_j}(1) & = w_{\alpha_j}(-1); \label{eq:Allcock-8-1} \\
        {}^{w_{\alpha_j}^2(1)} S_0 & = S_0^{-1}; \label{eq:Allcock-8-2} \\
        x_{\alpha_j}(a) \cdot S_0 \cdot w_{\alpha_j}(1) & = S_0 \cdot w_{\alpha_j}(1) \cdot X_0(a), & \label{eq:Allcock-9-1} \\
        X_0(a) \cdot w_{\alpha_j}(1) \cdot S_0 & = w_{\alpha_j}(1) \cdot S_0 \cdot x_{\alpha_j}(a), & \label{eq:Allcock-9-2} \\
        {}^{S_0^2} x_{\alpha_j}(a) & = x_{\alpha_j}(-a), & \label{eq:Allcock-10-1} \\
        {}^{w_{\alpha_j}^2(1)} X_0(a) & = X_0(-a) & \text{for $a \in A;$} \label{eq:Allcock-10-2} \\
        [X_0(a), {}^{S_0} x_{\alpha_j}(b)] &= 1, & \label{eq:Allcock-11-1} \\
        [x_{\alpha_j}(a), {}^{w_{\alpha_j}(1)}X_0(b)] &= 1, & \label{eq:Allcock-11-2} \\
        [X_0(a), x_{\alpha_j}(b)] &= {}^{S_0} x_{\alpha_j}(ab) & \text{for $a, b \in A.$} \label{eq:Allcock-12}
    \end{align}}
\end{prop}
\begin{proof}
    This is a direct consequence of our~\cref{lem:affine-vs-loop} and the presentation of~\cite[Theorem~1]{A16} (or, alternatively, \cite[Theorem~1.1]{A13} combined with~\cite[Theorem~1.3]{A13}).
    The list of relations in the statement is obtained from \cite[Table~1]{A16} by substituting concrete values of $i, j$, identifying Allcock's $X_{i}(a)$ with
     $x_{\alpha_i}(a)$ and $S_i$ with $w_{\alpha_i}(a)$ for all $i\neq 0$ and then omitting all the relations are already satisfied in $\St(\Phi, A)$ (relations not involving $X_0(a)$ or $S_0$).
    The only further simplification is that we have omitted the relation $[X_{\alpha_j}(b), X_0(a)] = {}^{w_{\alpha_j}(1)} X_0(ab)$ (the relation symmetric to~\eqref{eq:Allcock-12})
    because it is a consequence of~\eqref{eq:Allcock-9-2} and~\eqref{eq:Allcock-12}.
\end{proof}

Our next goal is to slightly simplify the presentation of~\cref{prop:Allcock-affine} by using the larger group $\St(\Phi, A[X])$ instead of $\St(\Phi, A)$ in the statement.
\begin{cor} \label{cor:Allcock-simpler}
    For a finite simply-laced irreducible root system $\Phi$ and an arbitrary commutative ring $A$ the Steinberg group $\St(\Phi, A[X, X\inv])$ is isomorphic
    to the free product of $\St(\Phi, A[X])$ and the cyclic group $\langle S \rangle$ amalgamated over the subgroup generated by the following list of relations:
    \begin{align}
    [S^2, x_{\alpha_0}(aX)] & = 1 & \text{ for $a \in A$; } \label{eq:simpler-2} \\
    x_{\alpha_0}(X) \cdot {}^{S} x_{\alpha_0}(X) \cdot x_{\alpha_0}(X) & = S; \label{eq:simpler-3} \\
    [S, w_{\alpha_i}(1)] & = 1 & \text{ for $i$ unjoined with $0$;} \label{eq:simpler-4} \\
    [S, x_{\alpha_i}(a)] & = 1 &  \text{ $i$ unj. with $0$, $a \in A$; } \label{eq:simpler-5-1}\\
    S \cdot w_{\alpha_j}(1) \cdot S & = w_{\alpha_j}(1) \cdot S \cdot w_{\alpha_j}(1); \label{eq:simpler-7} \\
    {}^{S^2} w_{\alpha_j}(1) & = w_{\alpha_j}(-1); \label{eq:simpler-8-1} \\
    {}^{w_{\alpha_j}^2(1)} S & = S^{-1}; \label{eq:simpler-8-2} \\
    x_{\alpha_j}(a) \cdot S \cdot w_{\alpha_j}(1) & = S \cdot w_{\alpha_j}(1) \cdot x_{\alpha_0}(aX), & \label{eq:simpler-9-1} \\
    x_{\alpha_0}(aX) \cdot w_{\alpha_j}(1) \cdot S & = w_{\alpha_j}(1) \cdot S \cdot x_{\alpha_j}(a), & \label{eq:simpler-9-2} \\
    {}^{S^2} x_{\alpha_j}(a) & = x_{\alpha_j}(-a) & \text{ for $a \in A$; } \label{eq:simpler-10-1} \\
    [x_{\alpha_0}(aX), {}^{S} x_{\alpha_j}(b)] &= 1, & \label{eq:simpler-11-1} \\
    [x_{\alpha_0}(aX), x_{\alpha_j}(b)] &= {}^{S} x_{\alpha_j}(ab) & \text{for $a, b \in A.$} \label{eq:simpler-12}
    \end{align}
\end{cor}
\begin{proof}
    The list of relations is obtained from~\eqref{eq:Allcock-2}--\eqref{eq:Allcock-12} by identifying $X_0(a)$ with $x_{\alpha_0}(aX)$, $S_0$ with $S$ and omitting those relations
     which are satisfied in the group $\St(\Phi, A[X])$ by virtue of Lemmas 5.1--5.2 of ~\cite{Ma69}.
\end{proof}

\subsection{Relationship between $\St(\Phi, A[X, X\inv])$ and $\St(\Phi, A[X])$.} \label{subsec:short-presentation}
Now let $\Phi$ be a root system of type $\rD_\ell$, $\rE_6$ or $\rE_7$.
Denote by $k$ the vertex of the extended Dynkin diagram marked green on Figure~1.
Recall that in each case $m_k(\alpha_\mathrm{\max}) = 1$, therefore $m_i(\alpha) = 1$ for all $\alpha \in \Sigma_k^+$ and the subgroup $\UU(\Sigma^+_k, R)$ is abelian.

Denote by $G$ the amalgamated product of $\St(\Phi, A[X])$ and the cyclic group $\langle \sigma \rangle$ amalgamated over the subgroup generated by the following relations:
\begin{align}
    {}^\sigma x_{\alpha}(f) = & x_{\alpha} (Xf), & \alpha \in \Sigma^+_k, f \in A[X], \label{eq:sigma-sigma-plus} \\
    x_{\beta}(f)^ \sigma     =& x_{\beta} (Xf), & \beta \in \Sigma^-_k, f \in A[X], \label{eq:sigma-sigma-minus} \\
    [\sigma,\, x_\gamma(f)]   =& 1, & \gamma \in \Delta, f \in A[X]. \label{eq:sigma-delta}
\end{align}
It is clear that the action of the generator $\sigma$ is chosen to mimick the action of the weight element $\chi_{\omega_k, X}$ from~\cref{subsec:weight-automorphisms}.

We denote by $i_+$ the canonical homomorphism $\St(\Phi, A[X]) \to G$ and by $h_+$ the canonical embedding $A[X] \to A[X, X\inv]$.

The main result of this subsection is the following
\begin{prop}
    For $\Phi$ as above there exists an arrow $\varphi$ making the diagram below commute:
    \[\begin{tikzcd}           & \St(\Phi, A[X, X\inv]) \arrow[rd, dashrightarrow, "\varphi"]] & \\
    \St(\Phi, A[X]) \arrow{ru}{h_+^*} \arrow{rr}{i_+} &                                & G.
    \end{tikzcd}\]
\end{prop}
\begin{proof}
 We will use the presentation of~\cref{cor:Allcock-simpler} for $\St(\Phi, A[X, X\inv])$.
 We only need to specify the value of $\varphi$ on the generator $S$.
 Observe that $-\alpha_0 = \alpha_{\max} \in \Sigma_k^+$, therefore the obvious candidate for the role of $\varphi(x_{-\alpha_0}(aX\inv))$ would be $x_{-\alpha_0}(a)^\sigma$, cf.~\eqref{eq:sigma-sigma-plus},
 which motivates the following definition for $\varphi(S)$:
 Set \[\varphi(S) := x_{\alpha_0}(X) \cdot x_{-\alpha_0}(-1)^\sigma \cdot x_{\alpha_0}(X).\]
 From~\eqref{eq:w-definition},\eqref{eq:sigma-sigma-minus} it follows that $\varphi(S) = w_{\alpha_0}(1)^\sigma$.

 We need to check that our definition is correct, namely that $\varphi$ preserves all the relations listed in~\cref{cor:Allcock-simpler}.
 We claim that this follows from the fact that substitution of $w_{\alpha_0}(1)^\sigma$ into $S$ turns every formula from \cref{cor:Allcock-simpler}
     into a $\sigma$-conjugate of a valid relation in $\St(\Phi, A[X])$.

 Let us illustrate this idea with a few examples.
 For example, to see that $\varphi$ preserves~\eqref{eq:simpler-3} use~\eqref{eq:sigma-sigma-minus} combined with~\cite[Lemma~5.1b]{Ma69}:
 \begin{multline*}
     \varphi(x_{\alpha_0}(X) \cdot {}^{S} x_{\alpha_0}(X) \cdot x_{\alpha_0}(X)) = x_{\alpha_0}(1)^\sigma \cdot {}^{w_{\alpha_0}(1)^\sigma} x_{\alpha_0}(1)^\sigma \cdot x_{\alpha_0}(1)^\sigma = \\
     = \left( x_{\alpha_0}(1) \cdot {}^{w_{\alpha_0}(1)} x_{\alpha_0}(1) \cdot x_{\alpha_0}(1)\right)^\sigma = \left(x_{\alpha_0}(1) \cdot x_{-\alpha_0}(-1) \cdot x_{\alpha_0}(1)\right)^\sigma = w_{\alpha_0}(1)^\sigma = \varphi(S).
 \end{multline*}

 Let us show that $\varphi$ preserves~\eqref{eq:simpler-5-1}.
 Set $g = x_{\alpha_i}(a)$ if $i \neq k$ and $g = x_{\alpha_k}(aX)$ if $i = k$.
 From~\eqref{eq:sigma-sigma-plus},\eqref{eq:sigma-delta} and the commutator formula we obtain that
 \begin{equation*}
     \varphi([S, x_{\alpha_i}(a)]) = [w_{\alpha_0}(1)^\sigma, x_{\alpha_i}(a)] = [w_{\alpha_0}(1)^\sigma, g^\sigma] = [w_{\alpha_0}(1), g]^\sigma = 1^\sigma = 1.
 \end{equation*}

 Let us show that $\varphi$ preserves~\eqref{eq:simpler-9-1}.
 First of all, notice that ${}^{w_{\alpha_0}(1) w_{\alpha_j}(1)} x_{\alpha_0}(a) = x_{\alpha_j}(a)$.
 This can be showed directly
 \begin{multline*}
     \varphi(x_{\alpha_j}(a) \cdot S \cdot w_{\alpha_j}(1)) = x_{\alpha_j}(a) \cdot w_{\alpha_0}(1)^\sigma \cdot w_{\alpha_j}(1) = \ldots \\
     \ldots = w_{\alpha_0}(1)^\sigma w_{\alpha_j}(1) \cdot x_{\alpha_0}(aX) = \varphi(S \cdot w_{\alpha_j}(1) \cdot x_{\alpha_0}(aX)).
 \end{multline*}
\end{proof}